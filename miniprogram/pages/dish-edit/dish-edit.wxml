<view class="container">
  <view class="card">
    <view class="section-title">{{id ? '编辑菜品' : '新增菜品'}}</view>
    <view class="muted">菜名必填，用料与步骤可排序</view>
  </view>

  <view class="card">
    <view class="section-title">基础信息</view>
    <input class="input" placeholder="菜名" value="{{name}}" bindinput="onNameInput" />
    <input class="input" placeholder="一句话简介" value="{{description}}" bindinput="onDescriptionInput" />
    <picker mode="selector" range="{{categoryOptions}}" range-key="name" value="{{categoryIndex}}" bindchange="onCategoryChange">
      <view class="input">{{categoryOptions[categoryIndex].name}}</view>
    </picker>
    <input class="input" placeholder="总时长(分钟)" type="number" value="{{cookTime}}" bindinput="onCookTimeInput" />
    <input class="input" placeholder="份量" type="number" value="{{servings}}" bindinput="onServingsInput" />
    <picker mode="selector" range="{{['easy','medium','hard']}}" bindchange="onDifficultyChange">
      <view class="input">{{difficulty || '难度'}}</view>
    </picker>
    <textarea class="input" placeholder="要点/踩坑" value="{{tips}}" bindinput="onTipsInput" />
  </view>

  <view class="card">
    <view class="row">
      <view class="section-title">用料</view>
      <view class="button-ghost" bindtap="addIngredient">添加用料</view>
    </view>
    <view wx:if="{{ingredients.length === 0}}" class="muted">暂无用料</view>
    <view wx:for="{{ingredients}}" wx:key="id" class="stack">
      <input class="input" placeholder="名称" value="{{item.name}}" data-index="{{index}}" data-field="name" bindinput="updateIngredient" />
      <input class="input" placeholder="用量" value="{{item.amount}}" data-index="{{index}}" data-field="amount" bindinput="updateIngredient" />
      <input class="input" placeholder="单位" value="{{item.unit}}" data-index="{{index}}" data-field="unit" bindinput="updateIngredient" />
      <input class="input" placeholder="备注" value="{{item.note}}" data-index="{{index}}" data-field="note" bindinput="updateIngredient" />
      <view class="button-ghost" data-index="{{index}}" bindtap="removeIngredient">删除用料</view>
    </view>
  </view>

  <view class="card">
    <view class="row">
      <view class="section-title">步骤</view>
      <view class="button-ghost" bindtap="addStep">添加步骤</view>
    </view>
    <view wx:if="{{steps.length === 0}}" class="muted">暂无步骤</view>
    <view wx:for="{{steps}}" wx:key="id" class="stack">
      <view class="muted">{{index + 1}}</view>
      <input class="input" placeholder="步骤内容" value="{{item.content}}" data-index="{{index}}" data-field="content" bindinput="updateStep" />
      <input class="input" placeholder="计时(分钟)" value="{{item.timerMinutes}}" data-index="{{index}}" data-field="timerMinutes" bindinput="updateStep" />
      <view class="row">
        <view class="button-ghost" data-index="{{index}}" data-direction="up" bindtap="moveStep">上移</view>
        <view class="button-ghost" data-index="{{index}}" data-direction="down" bindtap="moveStep">下移</view>
        <view class="button-ghost" data-index="{{index}}" bindtap="removeStep">删除</view>
      </view>
    </view>
  </view>

  <view class="button-primary" bindtap="saveDish">保存</view>
  <view wx:if="{{error}}" class="error">{{error}}</view>
</view>
