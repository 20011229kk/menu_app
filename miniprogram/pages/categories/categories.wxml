<van-config-provider theme-vars="{{vanThemeVars}}">
<view class="container">
  <view class="card">
    <view class="section-title">甜蜜分区 💗</view>
    <view class="muted">把常用分类整理得更有条理</view>
  </view>

  <view class="card category-add">
    <view class="section-title">新增分类</view>
    <view class="muted">为日常做饭建立清晰分区</view>
    <van-field
      placeholder="例如：热菜"
      value="{{name}}"
      bind:change="onNameInput"
      custom-class="van-field-soft"
    />
    <view class="actions-wrap add-actions">
      <view class="muted">建议按口味或场景命名</view>
      <van-button type="primary" custom-class="add-button" bind:tap="addCategory">添加分类</van-button>
    </view>
    <view wx:if="{{error}}" class="error">{{error}}</view>
  </view>

  <view wx:if="{{categories.length === 0}}" class="card empty-card">
    <van-empty description="还没有分类，先创建常用分类（如热菜/凉菜/汤）。" />
  </view>

  <view class="card" wx:for="{{categories}}" wx:key="id">
    <view class="row category-row">
      <view wx:if="{{editingId === item.id}}">
        <van-field value="{{editingName}}" bind:change="onEditInput" custom-class="van-field-soft edit-field" />
      </view>
      <view wx:else class="section-title category-title">{{item.name}}</view>
      <view class="actions-wrap actions-right">
        <van-button
          wx:if="{{editingId === item.id}}"
          size="small"
          type="primary"
          icon="success"
          custom-class="action-icon action-save"
          bind:tap="saveEdit"
        />
        <van-button
          wx:else
          size="small"
          type="default"
          icon="edit"
          custom-class="action-icon action-edit"
          data-id="{{item.id}}"
          data-name="{{item.name}}"
          bind:tap="startEdit"
        />
        <van-button
          size="small"
          type="default"
          icon="arrow-up"
          custom-class="action-icon action-move"
          data-id="{{item.id}}"
          data-direction="up"
          bind:tap="moveCategory"
        />
        <van-button
          size="small"
          type="default"
          icon="arrow-down"
          custom-class="action-icon action-move"
          data-id="{{item.id}}"
          data-direction="down"
          bind:tap="moveCategory"
        />
        <van-button
          size="small"
          type="danger"
          icon="delete"
          custom-class="action-icon action-delete"
          data-id="{{item.id}}"
          bind:tap="removeCategory"
        />
      </view>
    </view>
  </view>

  <view wx:if="{{lastDeleted}}" class="card undo-bar">
    <view>已删除分类：{{lastDeleted.name}}</view>
    <van-button size="small" type="default" bind:tap="undoDelete">撤销</van-button>
  </view>
</view>

<view wx:if="{{softToastVisible}}" class="soft-toast">{{softToastText}}</view>
</van-config-provider>
