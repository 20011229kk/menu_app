<view class="container">
  <view class="card">
    <view class="section-title">恋人菜谱 🥣</view>
    <view class="muted">搜一搜、挑一挑，灵感更轻松</view>
  </view>

  <view class="card">
    <van-field
      placeholder="搜索菜名/描述/用料"
      value="{{query}}"
      bind:change="onQueryInput"
      custom-class="van-field-soft"
    />
    <view class="actions-wrap actions-column">
      <view class="filter-row">
        <van-button size="small" type="default" custom-class="btn-inline">菜品分类</van-button>
        <picker mode="selector" range="{{categoryOptions}}" range-key="name" bindchange="onCategoryChange">
          <view class="filter-picker compact">
            <view class="filter-text">{{selectedCategoryLabel}}</view>
            <view class="filter-caret">▼</view>
          </view>
        </picker>
      </view>
      <view class="button-row">
        <van-button size="small" type="default" custom-class="btn-inline" data-mode="name" bind:tap="switchSort">名称排序</van-button>
        <van-button size="small" type="default" custom-class="btn-inline" data-mode="updatedAt" bind:tap="switchSort">更新排序</van-button>
        <van-button size="small" type="primary" custom-class="btn-inline" bind:tap="goToNew">新增菜品</van-button>
      </view>
    </view>
  </view>

  <view wx:if="{{filtered.length === 0}}" class="card empty-card">
    <van-empty description="暂无匹配菜品，试试更短的关键词。" />
    <van-button size="small" type="primary" bind:tap="goToNew">新增菜品</van-button>
  </view>

  <view class="card" wx:for="{{filtered}}" wx:key="id">
    <view class="row">
      <image wx:if="{{imageMap[item.id]}}" class="thumb" mode="aspectFill" src="{{imageMap[item.id]}}" />
      <view class="stack" style="flex: 1;">
        <view class="section-title">{{item.name}}</view>
        <view class="muted">{{item.description || '暂无简介'}}</view>
      </view>
      <van-button size="small" type="default" data-id="{{item.id}}" bind:tap="goToDetail">查看详情</van-button>
    </view>
  </view>
</view>

<view wx:if="{{softToastVisible}}" class="soft-toast">{{softToastText}}</view>
