<view class="container">
  <view class="card">
    <view class="section-title">编辑菜单</view>
    <view class="muted">从菜品库中选择并排序</view>
  </view>

  <view class="card">
    <view class="section-title">菜单名称</view>
    <van-field value="{{name}}" bind:change="onNameInput" custom-class="van-field-soft" />
  </view>

  <view class="card">
    <view class="section-title">菜单封面</view>
    <view class="image-uploader" bindtap="chooseCoverImage">
      <image wx:if="{{coverImage}}" class="image-uploader-img" mode="widthFix" src="{{coverImage}}" />
      <view wx:if="{{!coverImage}}" class="image-uploader-placeholder">点击上传图片</view>
    </view>
  </view>

  <view class="card">
    <view class="actions-wrap">
      <view class="section-title">添加菜品</view>
    </view>
    <picker mode="selector" range="{{dishes}}" range-key="name" bindchange="onDishSelect">
      <view class="input">{{dishes[selectedDishIndex] ? dishes[selectedDishIndex].name : '选择菜品'}} </view>
    </picker>
    <van-button size="small" type="primary" bind:tap="addDish">添加</van-button>
  </view>

  <view class="card">
    <view wx:if="{{menuItems.length === 0}}" class="muted">暂无菜品</view>
    <view wx:for="{{menuItems}}" wx:key="id" class="stack">
      <view class="menu-item-row">
        <view class="section-title menu-item-title">{{item.dishName}}</view>
        <view class="actions-wrap actions-right">
          <van-button size="small" type="default" custom-class="action-icon action-move" data-index="{{index}}" data-direction="up" bind:tap="moveItem">
            <van-icon name="arrow-up" />
          </van-button>
          <van-button size="small" type="default" custom-class="action-icon action-move" data-index="{{index}}" data-direction="down" bind:tap="moveItem">
            <van-icon name="arrow-down" />
          </van-button>
          <van-button size="small" type="danger" custom-class="action-icon action-delete" data-index="{{index}}" bind:tap="removeItem">
            <van-icon name="delete" />
          </van-button>
        </view>
      </view>
    </view>
  </view>

  <van-button type="primary" block bind:tap="saveMenu">保存菜单</van-button>
  <view wx:if="{{error}}" class="error">{{error}}</view>
</view>

<view wx:if="{{softToastVisible}}" class="soft-toast">{{softToastText}}</view>
